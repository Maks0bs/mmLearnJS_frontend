

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> views/ClassroomRouter/views/CourseRouter/views/EditContent/components/EntryEditor/EntryEditor.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
             
                <a href="index.html">
                    <h1 class="navbar-item">My React components</h1>
                </a>
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    API Documentation
                </a>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Namespaces</h3><ul><li><a href="components.html">components</a></li><li><a href="components.common.html">common</a></li><li><a href="components.views.html">views</a></li><li><a href="components.views.classroom.html">classroom</a></li><li><a href="components.views.classroom.course.html">course</a></li><li><a href="components.views.classroom.user.html">user</a></li><li><a href="components.views.components.html">components</a></li><li><a href="components.views.public.html">public</a></li><li><a href="storeState.html">storeState</a></li><li><a href="storeState.components.html">components</a></li><li><a href="storeState.componentsActions.html">componentsActions</a></li><li><a href="storeState.routingActions.html">routingActions</a></li><li><a href="storeState.servicesActions.html">servicesActions</a></li><li><a href="storeState.views.html">views</a></li><li><a href="storeState.views.classroom.html">classroom</a></li><li><a href="storeState.views.classroom.course.html">course</a></li><li><a href="storeState.views.classroom.course.courseServicesActions.html">courseServicesActions</a></li><li><a href="storeState.views.classroom.course.editContentActions.html">editContentActions</a></li><li><a href="storeState.views.classroom.courseListActions.html">courseListActions</a></li><li><a href="storeState.views.classroom.createCourseActions.html">createCourseActions</a></li><li><a href="storeState.views.classroom.dashboardActions.html">dashboardActions</a></li><li><a href="storeState.views.classroom.searchCoursesActions.html">searchCoursesActions</a></li><li><a href="storeState.views.classroom.userRouterActions.html">userRouterActions</a></li><li><a href="storeState.views.components.html">components</a></li><li><a href="storeState.views.components.activationMessageActions.html">activationMessageActions</a></li><li><a href="storeState.views.components.signinActions.html">signinActions</a></li><li><a href="storeState.views.public.html">public</a></li><li><a href="storeState.views.public.activateAccountActions.html">activateAccountActions</a></li><li><a href="storeState.views.public.forgotPasswordActions.html">forgotPasswordActions</a></li><li><a href="storeState.views.public.homeActions.html">homeActions</a></li><li><a href="storeState.views.public.resetPasswordActions.html">resetPasswordActions</a></li><li><a href="storeState.views.public.signupActions.html">signupActions</a></li><li><a href="storeStateActions.html">storeStateActions</a></li></ul><h3>Components</h3><ul><li><a href="components.App.html">App</a></li><li><a href="components.common.BigLoadingAbsolute.html">BigLoadingAbsolute</a></li><li><a href="components.common.BigLoadingCentered.html">BigLoadingCentered</a></li><li><a href="components.common.DownloadElement.html">DownloadElement</a></li><li><a href="components.common.EditSymbol.html">EditSymbol</a></li><li><a href="components.common.ModalRoot.html">ModalRoot</a></li><li><a href="components.common.NavDropdown.html">NavDropdown</a></li><li><a href="components.common.NavItem.html">NavItem</a></li><li><a href="components.common.NotificationItem.html">NotificationItem</a></li><li><a href="components.common.OptimizedComponent.html">OptimizedComponent</a></li><li><a href="components.common.OptimizedPureComponent.html">OptimizedPureComponent</a></li><li><a href="components.common.Reload.html">Reload</a></li><li><a href="components.common.SmallLoading.html">SmallLoading</a></li><li><a href="components.common.ToastRoot.html">ToastRoot</a></li><li><a href="components.common.UserPreview.html">UserPreview</a></li><li><a href="components.views.classroom.ClassroomMenu.html">ClassroomMenu</a></li><li><a href="components.views.classroom.ClassroomMenu.ClassroomMenuUserActions.html">ClassroomMenuUserActions</a></li><li><a href="components.views.classroom.ClassroomRouter.html">ClassroomRouter</a></li><li><a href="components.views.classroom.course.CourseRouter.html">CourseRouter</a></li><li><a href="components.views.classroom.course.EditContent.html">EditContent</a></li><li><a href="components.views.classroom.course.EditContent.EditContentActions.html">EditContentActions</a></li><li><a href="components.views.classroom.course.EditContent.EditContentHelp.html">EditContentHelp</a></li><li><a href="components.views.classroom.course.EditContent.EditContentRoot.html">EditContentRoot</a></li><li><a href="components.views.classroom.course.EditContent.SectionEditor.html">SectionEditor</a></li><li><a href="components.views.classroom.course.EditInfo.html">EditInfo</a></li><li><a href="components.views.classroom.course.TeacherRoute.html">TeacherRoute</a></li><li><a href="components.views.classroom.CourseList.html">CourseList</a></li><li><a href="components.views.classroom.CourseList.CollapsibleCourseList.html">CollapsibleCourseList</a></li><li><a href="components.views.classroom.CourseList.CourseListItem.html">CourseListItem</a></li><li><a href="components.views.classroom.CourseList.MainList.html">MainList</a></li><li><a href="components.views.classroom.CourseList.StudentList.html">StudentList</a></li><li><a href="components.views.classroom.CourseList.TeacherList.html">TeacherList</a></li><li><a href="components.views.classroom.CreateCourse.html">CreateCourse</a></li><li><a href="components.views.classroom.Dashboard.html">Dashboard</a></li><li><a href="components.views.classroom.Dashboard.ChooseDashboardFilterCourses.html">ChooseDashboardFilterCourses</a></li><li><a href="components.views.classroom.Dashboard.DashboardFilter.html">DashboardFilter</a></li><li><a href="components.views.classroom.Dashboard.DashboardNews.html">DashboardNews</a></li><li><a href="components.views.classroom.Dashboard.DashboardNews.DashboardNewsEntry.html">DashboardNewsEntry</a></li><li><a href="components.views.classroom.MainClassroom.html">MainClassroom</a></li><li><a href="components.views.classroom.SearchCourses.html">SearchCourses</a></li><li><a href="components.views.classroom.SearchCourses.CourseSearchItem.html">CourseSearchItem</a></li><li><a href="components.views.classroom.user.EditUser.html">EditUser</a></li><li><a href="components.views.classroom.user.EditUser.DeleteUserDialog.html">DeleteUserDialog</a></li><li><a href="components.views.classroom.user.EditUser.EditUserBasicData.html">EditUserBasicData</a></li><li><a href="components.views.classroom.user.EditUser.EditUserHiddenFields.html">EditUserHiddenFields</a></li><li><a href="components.views.classroom.user.EditUser.EditUserHiddenFields.AvailableFieldsDroppable.html">AvailableFieldsDroppable</a></li><li><a href="components.views.classroom.user.EditUser.EditUserHiddenFields.FieldEntityDraggable.html">FieldEntityDraggable</a></li><li><a href="components.views.classroom.user.EditUser.EditUserHiddenFields.HiddenFieldsDroppable.html">HiddenFieldsDroppable</a></li><li><a href="components.views.classroom.user.EditUser.EditUserPhoto.html">EditUserPhoto</a></li><li><a href="components.views.classroom.user.User.html">User</a></li><li><a href="components.views.classroom.user.User.UserBasicInfoAndActions.html">UserBasicInfoAndActions</a></li><li><a href="components.views.classroom.user.User.UserClassroomContent.html">UserClassroomContent</a></li><li><a href="components.views.classroom.user.UserRouter.html">UserRouter</a></li><li><a href="components.views.components.ActivationMessage.html">ActivationMessage</a></li><li><a href="components.views.components.Signin.html">Signin</a></li><li><a href="components.views.public.ActivateAccount.html">ActivateAccount</a></li><li><a href="components.views.public.ForgotPassword.html">ForgotPassword</a></li><li><a href="components.views.public.Home.html">Home</a></li><li><a href="components.views.public.Home.NewsFeed.html">NewsFeed</a></li><li><a href="components.views.public.InviteSignup.html">InviteSignup</a></li><li><a href="components.views.public.PublicMenu.html">PublicMenu</a></li><li><a href="components.views.public.PublicRouter.html">PublicRouter</a></li><li><a href="components.views.public.ResetPassword.html">ResetPassword</a></li><li><a href="components.views.public.Signin.html">Signin</a></li><li><a href="components.views.public.Signup.html">Signup</a></li><li><a href="components.views.public.SignupComponent.html">SignupComponent</a></li><li><a href="components.views.public.SignupComponent.SignupForm.html">SignupForm</a></li></ul><h3>Global</h3><ul><li><a href="global.html#getBeautifulFieldName">getBeautifulFieldName</a></li><li><a href="global.html#getCurUserCourseStatus">getCurUserCourseStatus</a></li><li><a href="global.html#getDateHtmlFormattedString">getDateHtmlFormattedString</a></li><li><a href="global.html#getExercisePositionById">getExercisePositionById</a></li><li><a href="global.html#getFirstTimeStatus">getFirstTimeStatus</a></li><li><a href="global.html#getUserSubscribedSet">getUserSubscribedSet</a></li><li><a href="global.html#reorderArray">reorderArray</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>views/ClassroomRouter/views/CourseRouter/views/EditContent/components/EntryEditor/EntryEditor.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { Component } from 'react';
import { Link, Redirect, withRouter } from 'react-router-dom'
import { editEntry, preDeleteEntry, addEntry } from "../../services/actions";
import { connect } from 'react-redux'
import DownloadElement from "../../../../../../../../components/reusables/DownloadElement";
import { extend } from 'lodash'
import PropTypes from "prop-types";


// make controlled components

class EditEntry extends Component {
    constructor(props){
        super(props);

        this.state = {
            name: '',
            content: null,
            access: 'students',
            teachersOnlyForum: false,
            type: ''
        }

    }

    componentDidMount() {
        /*
            Here entries are handled differently depending on their type:
            Forum:
                state.content = content.description
                separate variable for teachersOnly
            Text:
                state.content = content.text
            File:
                the file itself can only be re-uploaded, that's why
                state.content = new file (if any)
            Only one state variable for different types of content is used to keep
            code more flexible (but, unfortunately it makes it less understandable)
            in the onSubmit method the state gets packed back into
            the form that is suitable for the API
        */
        let { sectionNum, entryNum } = this.props;
        let entry = this.props.courseData.sections[sectionNum].entries[entryNum];
        let entryContent = entry.content;
        switch (entry.type){
            case 'text': {
                entryContent = entryContent.text;
                break;
            }
            case 'forum': {
                entryContent = entryContent.description
                this.setState({
                    teachersOnlyForum: entry.content.teachersOnly
                })
                break;
            }
            default:
                entryContent = entry.content;
                break;
        }
        this.setState({
            name: entry.name,
            content: entryContent,
            access: entry.access
        })
    }

    handleChange = (name) => (event) => {
        this.setState({
            [name]: event.target.value
        })
    }

    handleTeachersOnlyForum = () => {
        this.setState({
            teachersOnlyForum: !this.state.teachersOnlyForum
        })
    }

    handleLeave = () => {
        this.props.onClose &amp;&amp; this.props.onClose();
    }

    onSubmit = (event) => {
        event.preventDefault();
        let { sectionNum, entryNum } = this.props;
        let oldEntry = this.props.courseData.sections[sectionNum].entries[entryNum];
        let { type } = oldEntry;
        let { name, content, access, teachersOnlyForum } = this.state;
        switch (type){
            case 'text': {
                content = {
                    text: content
                }
                break;
            }
            case 'forum': {
                content = extend(oldEntry.content, {
                    teachersOnly: teachersOnlyForum,
                    description: content
                });
                break;
            }
            default:
                break;
        }
        this.props.editEntry(
            {
                name,
                content,
                access
            },
            this.props.sectionNum,
            this.props.entryNum
        )
        this.handleLeave();
    }

    onPreDelete = (event) => {
        event.preventDefault();
        this.props.preDeleteEntry(
            this.props.sectionNum,
            this.props.entryNum
        )
        this.handleLeave();
    }

    handleFileChange = (e) => {
        this.setState({
            content: e.target.files[0]
        })
    }

    componentWillUnmount(){
        this.handleLeave();
    }


    render() {
        let { name, content, access, teachersOnlyForum } = this.state;
        /*if (!name){
            return null;
        }*/
        let { sectionNum, entryNum } = this.props;
        let { type, content: oldContent } = this.props.courseData.sections[sectionNum].entries[entryNum];
        return (
            &lt;div className="container">
                &lt;form  onSubmit={this.onSubmit}>
                    &lt;div className="form-group">
                        &lt;label className="text-muted">Name&lt;/label>
                        &lt;input
                            onChange={this.handleChange("name")}
                            type="text"
                            className="form-control"
                            value={name}
                        />
                    &lt;/div>

                    {(() => {
                        switch(type) {
                            case 'text':
                                return(
                                    &lt;div className="form-group">
                                        &lt;label className="text-muted">Text&lt;/label>
                                        &lt;input
                                            onChange={this.handleChange("content")}
                                            type="text"
                                            className="form-control"
                                            value={content}
                                        />
                                    &lt;/div>
                                )
                            case 'file':
                                return (
                                    &lt;div>
                                        {!oldContent.id ? (
                                            &lt;a
                                                href={URL.createObjectURL(oldContent)}
                                                download={oldContent.name}

                                            >
                                                {oldContent.name}
                                            &lt;/a>
                                        ) : (
                                            &lt;div>
                                                &lt;label className="text-muted mr-1">Old file:&lt;/label>
                                                &lt;DownloadElement
                                                    id={oldContent.id}
                                                    name={oldContent.originalname}
                                                />
                                            &lt;/div>
                                        )}
                                        &lt;div className="custom-file mb-2 mt-2">
                                            &lt;label className="text-muted mr-1">Change file:&lt;/label>

                                            &lt;input
                                                type="file"
                                                onChange={this.handleFileChange}
                                            />
                                        &lt;/div>
                                    &lt;/div>
                                )
                            case 'forum':
                                return (
                                    &lt;div>
                                        &lt;div className="form-group">
                                            &lt;label className="text-muted">Description&lt;/label>
                                            &lt;input
                                                onChange={this.handleChange("content")}
                                                type="text"
                                                className="form-control"
                                                value={content || ''}
                                            />
                                        &lt;/div>
                                        &lt;div className="form-group">
                                            &lt;label className="text-muted">Only teachers can post&lt;/label>
                                            &lt;input
                                                type="checkbox"
                                                onChange={this.handleTeachersOnlyForum}
                                                className="ml-3"
                                                checked={teachersOnlyForum}
                                            />
                                        &lt;/div>
                                        &lt;p>
                                            Please go to the { }
                                            &lt;Link
                                                to={`/classroom/course/${this.props.courseData._id}/forum/` +
                                                `${this.props.courseData.sections[sectionNum].entries[entryNum]._id}
                                                `}
                                                target="_blank"
                                            >
                                                forum page
                                            &lt;/Link>
                                            { } to edit forum content as a teacher there
                                        &lt;/p>
                                    &lt;/div>
                                )
                        }
                    })()}

                    &lt;div className="form-group">
                        &lt;label className="text-muted mr-2">Choose who has access:&lt;/label>
                        &lt;select
                            name="access"
                            value={access}
                            onChange={this.handleChange("access")}
                        >
                            &lt;option value="students">Students and teachers&lt;/option>
                            &lt;option value="teachers">Teachers&lt;/option>
                        &lt;/select>
                    &lt;/div>


                    &lt;button
                        className="btn btn-outline btn-raised"
                        onClick={this.handleLeave}
                        type="button"
                    >
                        Cancel
                    &lt;/button>
                    &lt;button
                        className="btn btn-outline btn-raised btn-danger ml-3"
                        onClick={this.onPreDelete}
                        type="button"
                    >
                        Delete
                    &lt;/button>

                    {(() => {
                        if (type &amp;&amp; name){
                            return (
                                &lt;button
                                    className="btn btn-outline btn-raised btn-success ml-3"
                                    type="submit"
                                >
                                    Save
                                &lt;/button>
                            )
                        }
                    })()}

                &lt;/form>
            &lt;/div>
        );
    }
}

let mapStateToProps = (state) => ({
    ...state.views.classroom.course.editContent
})
let mapDispatchToProps = (dispatch) => ({
    editEntry: (entry, sectionNum, entryNum) =>
        dispatch(editEntry(entry, sectionNum, entryNum)),
    preDeleteEntry: (sectionNum, entryNum, type, content) =>
        dispatch(preDeleteEntry(sectionNum, entryNum, type, content))
})
SectionEditor.propTypes = {
    /**
     * Action that should be performed if this component
     * is inside a modal and it gets closed
     */
    onClose: PropTypes.func,
    /**
     * Should be provided if `newSection` props if falsy
     */
    sectionNum: PropTypes.number,
    /**
     * Should be true if the editor should create a new section at the end of the list
     */
    addNew: PropTypes.bool
}
export default connect(
    mapStateToProps,
    mapDispatchToProps
)(withRouter(EditEntry));
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.5</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by 
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

</body>
</html>
